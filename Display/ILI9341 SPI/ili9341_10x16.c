///////////////////////////////////////////////////////////////////
//           ILI8341 Color LCD DEMO with ATMega328               //
///////////////////////////////////////////////////////////////////
//  Mikrocontroller:  ATMEL AVR ATmega32,  8 MHz                //
//                                                               //
//  Compiler:         GCC (GNU AVR C-Compiler)                   //
//  Author:           Peter Rachow (DK7IH)                       //
//                    OCT-2019                                   // 
///////////////////////////////////////////////////////////////////
/*                                                               // 
 Datasheet:                                                      //
 //
*/                                                               //
///////////////////////////////////////////////////////////////////
//                                                               //
//SOFTWARE                                                       //
//                                                               //
// This Demo ist text-oriented. There are no graphical functions // 
// included. The code can be used to write text data in 65536    //
// different colors to the LCD's screen.                         //
//                                                               //
// An 8x12 pixel font is integrated.                             //
//                                                               //
// Font display can be indivudually scaled by determing "strech" //
// factors for x and y seperately. So a wide variety of text     //
// layouts can be achived.                                       //
//                                                               //
///////////////////////////////////////////////////////////////////
//                                                               //
//HARDWARE                                                       //
//                                                               //
//Connectors of LCD breakout board (read from left to right)     //
//                                                               //
///////////////////////////////////////////////////////////////////

#define F_CPU 16000000

#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <avr/io.h>
#include <avr/interrupt.h>
#include <avr/sleep.h>
#include <avr/eeprom.h>
#include <util/delay.h>

//LCD ILI9341
//SPI defines
#define LCDPORT PORTD
#define LCDDDR DDRD
#define LCD_SCK 1
#define LCD_SDA 2
#define LCD_DC 4
#define LCD_RES 8
#define LCD_CS 16

#define LCD_CMD   0
#define LCD_DATA  1

#define LCD_WIDTH   320
#define LCD_HEIGHT  240	

#define WHITE       0xFFFF
#define SILVER      0xC618
#define BLACK       0x0000
#define GREY        0x8410
#define RED         0xF800
#define MAROON      0x8000
#define FUCHSIA     0xF81F		
#define PURPLE      0x8010
#define LIME        0x07E0
#define GREEN       0x0400
#define YELLOW      0xFFE0
#define OLIVE       0x8400
#define BLUE        0x001F
#define NAVY        0x0010
#define AQUA        0x07FF
#define TEAL        0x0410
#define DARK_BLUE   0x0002

//Font
#define FONTWIDTH 10 
#define FONTHEIGHT 16

//Font: 10x16 vertical LSB
const char xchar[][24]={
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x00
{0x07,0x80,0x0C,0xC0,0x0A,0x40,0x14,0xA0,0x14,0x20,0x14,0x20,0x14,0xA0,0x0A,0x40,0x0C,0xC0,0x07,0x80},	// 0x01
{0x07,0x80,0x0F,0xC0,0x0D,0xC0,0x1B,0x60,0x1B,0xE0,0x1B,0xE0,0x1B,0x60,0x0D,0xC0,0x0F,0xC0,0x07,0x80},	// 0x02
{0x00,0x7C,0x01,0xFE,0x07,0xFE,0x0F,0xFE,0x1F,0xFC,0x1F,0xFC,0x0F,0xFE,0x07,0xFE,0x01,0xFE,0x00,0x7C},	// 0x03
{0x00,0x80,0x01,0xC0,0x03,0xF0,0x07,0xF8,0x1F,0xFE,0x0F,0xF8,0x07,0xF0,0x03,0xE0,0x01,0xC0,0x00,0x80},	// 0x04
{0x01,0xC0,0x03,0xE0,0x03,0xE0,0x03,0xFC,0x1F,0xFE,0x1D,0xFE,0x03,0xFC,0x03,0xE0,0x03,0xE0,0x01,0xC0},	// 0x05
{0x01,0xC0,0x03,0xE0,0x03,0xF0,0x03,0xF8,0x1F,0xFC,0x1D,0xFE,0x03,0xF8,0x03,0xF0,0x03,0xE0,0x01,0xC0},	// 0x06
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x07
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x08
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x09
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x0A
{0x07,0x80,0x08,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x10,0x24,0x08,0x74,0x07,0x8E,0x00,0x0E,0x00,0x18},	// 0x0B
{0x00,0x00,0x00,0x78,0x04,0x84,0x05,0x02,0x1F,0x02,0x05,0x02,0x05,0x82,0x00,0x84,0x00,0x78,0x00,0x00},	// 0x0C
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x0D
{0x60,0x00,0x70,0x00,0x70,0x00,0x3F,0xF8,0x00,0x18,0x0C,0x08,0x0E,0x0C,0x0E,0x04,0x07,0xFE,0x00,0x00},	// 0x0E
{0x00,0x80,0x03,0xF0,0x03,0x20,0x02,0x10,0x06,0x18,0x02,0x10,0x02,0x20,0x03,0x30,0x03,0xD0,0x00,0x80},	// 0x0F
{0x1F,0xF0,0x0F,0xE0,0x0F,0xE0,0x07,0xC0,0x07,0xC0,0x07,0xC0,0x03,0x80,0x03,0x80,0x01,0x00,0x01,0x00},	// 0x10
{0x01,0x00,0x01,0x00,0x03,0x80,0x03,0x80,0x07,0xC0,0x07,0xC0,0x07,0xC0,0x0F,0xE0,0x0F,0xE0,0x1F,0xF0},	// 0x11
{0x00,0x00,0x00,0x00,0x10,0x08,0x20,0x04,0x7F,0xFE,0x20,0x04,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x12
{0x00,0x00,0x00,0x00,0x1B,0xFE,0x00,0x00,0x00,0x00,0x1B,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x13
{0x00,0x00,0x00,0x1C,0x00,0x3E,0x00,0x7E,0x7F,0xFE,0x00,0x02,0x00,0x02,0x7F,0xFE,0x00,0x00,0x00,0x00},	// 0x14
{0x00,0x00,0x00,0x00,0x61,0xDC,0x43,0x32,0x42,0x22,0x46,0x62,0x4C,0x42,0x3B,0x82,0x00,0x00,0x00,0x00},	// 0x15
{0x00,0x00,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0x00},	// 0x16
{0x00,0x00,0x00,0x00,0x88,0x08,0x90,0x04,0xBF,0xFE,0x90,0x04,0x88,0x08,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x17
{0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x04,0x7F,0xFE,0x00,0x04,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x18
{0x00,0x00,0x00,0x00,0x10,0x00,0x20,0x00,0x7F,0xFE,0x20,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x19
{0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x05,0x40,0x03,0x80,0x01,0x00,0x00,0x00},	// 0x1A
{0x00,0x00,0x01,0x00,0x03,0x80,0x05,0x40,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00},	// 0x1B
{0x00,0x00,0x1F,0xE0,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x00,0x00},	// 0x1C
{0x00,0x00,0x01,0x00,0x03,0x80,0x05,0x40,0x01,0x00,0x01,0x00,0x05,0x40,0x03,0x80,0x01,0x00,0x00,0x00},	// 0x1D
{0x10,0x00,0x18,0x00,0x1E,0x00,0x1F,0x80,0x1F,0xC0,0x1F,0xF0,0x1F,0xC0,0x1F,0x00,0x1C,0x00,0x10,0x00},	// 0x1E
{0x00,0x10,0x00,0x30,0x00,0xF0,0x03,0xF0,0x07,0xF0,0x1F,0xF0,0x07,0xF0,0x01,0xF0,0x00,0x70,0x00,0x10},	// 0x1F
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x20
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1B,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x21
{0x00,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x22
{0x01,0x00,0x19,0x20,0x07,0xA0,0x01,0x78,0x19,0x26,0x07,0xA0,0x01,0x78,0x01,0x26,0x01,0x20,0x00,0x00},	// 0x23
{0x00,0x00,0x00,0x00,0x18,0x1C,0x10,0x26,0x10,0x42,0x3F,0xFF,0x11,0x82,0x0F,0x02,0x00,0x00,0x00,0x00},	// 0x24
{0x10,0x1C,0x08,0x22,0x04,0x22,0x03,0x22,0x00,0x9C,0x0E,0x40,0x11,0x30,0x11,0x08,0x11,0x04,0x0E,0x02},	// 0x25
{0x07,0x00,0x08,0x80,0x10,0x5C,0x10,0x62,0x11,0xA2,0x13,0x32,0x1C,0x1C,0x18,0x00,0x16,0x00,0x01,0x80},	// 0x26
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x27
{0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x18,0x18,0x30,0x0C,0x20,0x04,0x40,0x02,0x40,0x02,0x00,0x00},	// 0x28
{0x00,0x00,0x40,0x02,0x40,0x02,0x20,0x04,0x30,0x0C,0x18,0x18,0x07,0xE0,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x29
{0x00,0x00,0x00,0x08,0x00,0x18,0x00,0xF0,0x00,0x4E,0x00,0xF0,0x00,0x18,0x00,0x08,0x00,0x00,0x00,0x00},	// 0x2A
{0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x1F,0xE0,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x00,0x00},	// 0x2B
{0x00,0x00,0x00,0x00,0x00,0x00,0x98,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x2C
{0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00},	// 0x2D
{0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x2E
{0x00,0x00,0x40,0x00,0x30,0x00,0x0C,0x00,0x03,0x00,0x00,0xC0,0x00,0x30,0x00,0x0C,0x00,0x02,0x00,0x00},	// 0x2F
{0x00,0x00,0x03,0xF0,0x0C,0x0C,0x10,0x02,0x10,0x02,0x10,0x02,0x0C,0x0C,0x03,0xF0,0x00,0x00,0x00,0x00},	// 0x30
{0x00,0x00,0x10,0x04,0x10,0x04,0x10,0x04,0x1F,0xFE,0x10,0x00,0x10,0x00,0x10,0x00,0x00,0x00,0x00,0x00},	// 0x31
{0x00,0x00,0x18,0x06,0x14,0x02,0x12,0x02,0x11,0x02,0x10,0xC2,0x10,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x32
{0x00,0x00,0x00,0x00,0x10,0x02,0x10,0x42,0x10,0x42,0x10,0x42,0x0F,0xBC,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x33
{0x03,0x00,0x02,0xC0,0x02,0x20,0x02,0x18,0x02,0x04,0x1F,0xFE,0x02,0x00,0x02,0x00,0x00,0x00,0x00,0x00},	// 0x34
{0x00,0x00,0x00,0x00,0x10,0x3E,0x10,0x22,0x10,0x22,0x08,0x42,0x07,0x82,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x35
{0x00,0x00,0x07,0xF0,0x08,0x4C,0x10,0x22,0x10,0x22,0x10,0x22,0x08,0x42,0x07,0x80,0x00,0x00,0x00,0x00},	// 0x36
{0x00,0x00,0x00,0x02,0x18,0x02,0x07,0x02,0x00,0xC2,0x00,0x32,0x00,0x0A,0x00,0x06,0x00,0x00,0x00,0x00},	// 0x37
{0x00,0x00,0x0F,0x1C,0x10,0xA2,0x10,0x42,0x10,0x42,0x10,0xA2,0x09,0xA2,0x06,0x1C,0x00,0x00,0x00,0x00},	// 0x38
{0x00,0x00,0x00,0x78,0x10,0x84,0x11,0x02,0x11,0x02,0x11,0x02,0x0C,0x84,0x03,0xF8,0x00,0x00,0x00,0x00},	// 0x39
{0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x60,0x18,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x3A
{0x00,0x00,0x00,0x00,0x00,0x00,0x98,0x60,0x78,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x3B
{0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x04,0x80,0x04,0x80,0x08,0x40,0x08,0x40,0x10,0x20,0x00,0x00},	// 0x3C
{0x00,0x00,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x00,0x00},	// 0x3D
{0x00,0x00,0x10,0x20,0x08,0x40,0x08,0x40,0x04,0x80,0x04,0x80,0x03,0x00,0x03,0x00,0x00,0x00,0x00,0x00},	// 0x3E
{0x00,0x00,0x00,0x0E,0x00,0x02,0x1B,0x02,0x00,0x82,0x00,0x42,0x00,0x26,0x00,0x1C,0x00,0x00,0x00,0x00},	// 0x3F
{0x03,0xF0,0x0C,0x18,0x18,0x04,0x13,0xE2,0x14,0x12,0x16,0x0A,0x1B,0x8A,0x07,0xFC,0x04,0x00,0x04,0x00},	// 0x40
{0x10,0x00,0x0E,0x00,0x03,0x80,0x02,0x70,0x02,0x18,0x02,0x30,0x02,0xC0,0x03,0x00,0x0C,0x00,0x10,0x00},	// 0x41
{0x00,0x00,0x1F,0xF8,0x10,0x88,0x10,0x88,0x10,0x88,0x10,0x88,0x11,0x48,0x0E,0x30,0x00,0x00,0x00,0x00},	// 0x42
{0x03,0xC0,0x0C,0x30,0x08,0x10,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x18,0x00,0x00,0x00,0x00},	// 0x43
{0x00,0x00,0x1F,0xF8,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x08,0x10,0x07,0xE0,0x00,0x00,0x00,0x00},	// 0x44
{0x00,0x00,0x1F,0xF8,0x11,0x08,0x11,0x08,0x11,0x08,0x11,0x08,0x11,0x08,0x10,0x08,0x00,0x00,0x00,0x00},	// 0x45
{0x00,0x00,0x1F,0xF8,0x01,0x08,0x01,0x08,0x01,0x08,0x01,0x08,0x01,0x08,0x00,0x08,0x00,0x00,0x00,0x00},	// 0x46
{0x00,0x00,0x03,0xC0,0x0C,0x30,0x08,0x10,0x10,0x08,0x10,0x08,0x11,0x08,0x11,0x08,0x1F,0x18,0x00,0x00},	// 0x47
{0x00,0x00,0x1F,0xF8,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x1F,0xF8,0x00,0x00,0x00,0x00},	// 0x48
{0x00,0x00,0x10,0x08,0x10,0x08,0x10,0x08,0x1F,0xF8,0x10,0x08,0x10,0x08,0x10,0x08,0x00,0x00,0x00,0x00},	// 0x49
{0x00,0x00,0x00,0x00,0x10,0x00,0x10,0x08,0x10,0x08,0x10,0x08,0x0F,0xF8,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x4A
{0x00,0x00,0x1F,0xF8,0x00,0x80,0x01,0x80,0x02,0x40,0x04,0x20,0x04,0x10,0x08,0x08,0x10,0x00,0x00,0x00},	// 0x4B
{0x00,0x00,0x1F,0xF8,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x00,0x00,0x00,0x00},	// 0x4C
{0x1F,0xF8,0x00,0x38,0x01,0xE0,0x07,0x00,0x06,0x00,0x01,0xC0,0x00,0x38,0x1F,0xF8,0x00,0x00,0x00,0x00},	// 0x4D
{0x00,0x00,0x1F,0xF8,0x00,0x10,0x00,0x60,0x01,0x80,0x06,0x00,0x08,0x00,0x1F,0xF8,0x00,0x00,0x00,0x00},	// 0x4E
{0x00,0x00,0x07,0xE0,0x08,0x10,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x08,0x10,0x07,0xE0,0x00,0x00},	// 0x4F
{0x00,0x00,0x1F,0xF8,0x01,0x08,0x01,0x08,0x01,0x08,0x01,0x08,0x00,0x88,0x00,0x70,0x00,0x00,0x00,0x00},	// 0x50
{0x00,0x00,0x07,0xE0,0x08,0x10,0x10,0x08,0x10,0x08,0x10,0x08,0x30,0x08,0x48,0x10,0x47,0xE0,0x00,0x00},	// 0x51
{0x00,0x00,0x1F,0xF8,0x01,0x08,0x01,0x08,0x03,0x08,0x04,0x88,0x08,0x70,0x10,0x00,0x00,0x00,0x00,0x00},	// 0x52
{0x00,0x00,0x18,0x70,0x10,0x48,0x10,0x88,0x10,0x88,0x11,0x08,0x09,0x08,0x0E,0x18,0x00,0x00,0x00,0x00},	// 0x53
{0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x1F,0xF8,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x00},	// 0x54
{0x00,0x00,0x07,0xF8,0x18,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x08,0x00,0x07,0xF8,0x00,0x00,0x00,0x00},	// 0x55
{0x00,0x08,0x00,0x30,0x01,0xC0,0x06,0x00,0x18,0x00,0x18,0x00,0x07,0x00,0x00,0xC0,0x00,0x30,0x00,0x08},	// 0x56
{0x00,0x18,0x03,0xE0,0x1C,0x00,0x0F,0x00,0x00,0xE0,0x01,0xC0,0x0E,0x00,0x1C,0x00,0x03,0xE0,0x00,0x18},	// 0x57
{0x10,0x08,0x08,0x10,0x04,0x20,0x02,0x40,0x01,0x80,0x01,0x80,0x02,0x40,0x04,0x20,0x08,0x10,0x10,0x08},	// 0x58
{0x00,0x08,0x00,0x10,0x00,0x60,0x00,0x80,0x1F,0x00,0x00,0x80,0x00,0x40,0x00,0x20,0x00,0x10,0x00,0x08},	// 0x59
{0x00,0x00,0x18,0x08,0x14,0x08,0x12,0x08,0x11,0x08,0x10,0x88,0x10,0x48,0x10,0x28,0x10,0x18,0x00,0x00},	// 0x5A
{0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFE,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x00,0x00,0x00,0x00},	// 0x5B
{0x00,0x00,0x00,0x02,0x00,0x0C,0x00,0x30,0x00,0xC0,0x03,0x00,0x0C,0x00,0x30,0x00,0x40,0x00,0x00,0x00},	// 0x5C
{0x00,0x00,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x5D
{0x00,0x00,0x04,0x00,0x03,0x00,0x00,0xE0,0x00,0x38,0x00,0x0E,0x00,0x70,0x03,0x80,0x04,0x00,0x00,0x00},	// 0x5E
{0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00},	// 0x5F
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x60
{0x00,0x00,0x0C,0x00,0x12,0x20,0x11,0x20,0x11,0x20,0x09,0x20,0x1F,0xC0,0x10,0x00,0x00,0x00,0x00,0x00},	// 0x61
{0x00,0x00,0x1F,0xFE,0x08,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x08,0x60,0x07,0x80,0x00,0x00,0x00,0x00},	// 0x62
{0x00,0x00,0x07,0x80,0x08,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x10,0x20,0x10,0x20,0x00,0x00,0x00,0x00},	// 0x63
{0x00,0x00,0x07,0x80,0x18,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x08,0x40,0x1F,0xFE,0x00,0x00,0x00,0x00},	// 0x64
{0x00,0x00,0x07,0x80,0x09,0x40,0x11,0x20,0x11,0x20,0x11,0x20,0x11,0x20,0x11,0xC0,0x00,0x00,0x00,0x00},	// 0x65
{0x00,0x00,0x00,0x20,0x00,0x20,0x1F,0xFC,0x00,0x24,0x00,0x22,0x00,0x22,0x00,0x22,0x00,0x22,0x00,0x00},	// 0x66
{0x00,0x00,0x07,0x80,0x98,0x40,0x90,0x20,0x90,0x20,0x90,0x20,0x48,0x40,0x3F,0xE0,0x00,0x00,0x00,0x00},	// 0x67
{0x00,0x00,0x1F,0xFE,0x00,0x80,0x00,0x40,0x00,0x20,0x00,0x20,0x00,0x20,0x1F,0xC0,0x00,0x00,0x00,0x00},	// 0x68
{0x00,0x00,0x00,0x20,0x00,0x20,0x00,0x26,0x1F,0xE6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x69
{0x00,0x00,0x80,0x00,0x80,0x20,0x80,0x20,0x80,0x26,0x7F,0xE6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x6A
{0x00,0x00,0x1F,0xFE,0x01,0x00,0x03,0x00,0x04,0x80,0x04,0x40,0x08,0x40,0x10,0x20,0x00,0x00,0x00,0x00},	// 0x6B
{0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x02,0x00,0x02,0x1F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x6C
{0x1F,0xE0,0x00,0x40,0x00,0x20,0x00,0x20,0x1F,0xC0,0x00,0x40,0x00,0x20,0x00,0x20,0x1F,0xC0,0x00,0x00},	// 0x6D
{0x00,0x00,0x1F,0xE0,0x00,0xC0,0x00,0x40,0x00,0x20,0x00,0x20,0x00,0x20,0x1F,0xC0,0x00,0x00,0x00,0x00},	// 0x6E
{0x00,0x00,0x07,0x80,0x08,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x08,0x40,0x07,0x80,0x00,0x00,0x00,0x00},	// 0x6F
{0x00,0x00,0xFF,0xE0,0x08,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x08,0x60,0x07,0x80,0x00,0x00,0x00,0x00},	// 0x70
{0x00,0x00,0x07,0x80,0x18,0x40,0x10,0x20,0x10,0x20,0x10,0x20,0x08,0x40,0xFF,0xE0,0x00,0x00,0x00,0x00},	// 0x71
{0x00,0x00,0x00,0x00,0x1F,0xE0,0x00,0x80,0x00,0x40,0x00,0x20,0x00,0x20,0x00,0xE0,0x00,0x00,0x00,0x00},	// 0x72
{0x00,0x00,0x18,0xC0,0x11,0x20,0x11,0x20,0x12,0x20,0x12,0x20,0x0C,0x20,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x73
{0x00,0x00,0x00,0x20,0x00,0x20,0x0F,0xF8,0x10,0x20,0x10,0x20,0x10,0x20,0x10,0x20,0x00,0x00,0x00,0x00},	// 0x74
{0x00,0x00,0x0F,0xE0,0x10,0x00,0x10,0x00,0x10,0x00,0x08,0x00,0x1F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x75
{0x00,0x20,0x01,0xC0,0x06,0x00,0x18,0x00,0x10,0x00,0x0C,0x00,0x03,0x00,0x00,0xC0,0x00,0x20,0x00,0x00},	// 0x76
{0x00,0x60,0x07,0x80,0x18,0x00,0x0E,0x00,0x01,0xC0,0x01,0x80,0x0E,0x00,0x18,0x00,0x07,0x80,0x00,0x60},	// 0x77
{0x00,0x00,0x10,0x20,0x08,0x40,0x04,0x80,0x03,0x00,0x03,0x00,0x04,0x80,0x08,0x40,0x10,0x20,0x00,0x00},	// 0x78
{0x80,0x20,0x80,0xC0,0x83,0x00,0x46,0x00,0x38,0x00,0x18,0x00,0x06,0x00,0x01,0x00,0x00,0xC0,0x00,0x20},	// 0x79
{0x00,0x00,0x10,0x20,0x18,0x20,0x14,0x20,0x12,0x20,0x11,0x20,0x10,0xA0,0x10,0x60,0x10,0x20,0x00,0x00},	// 0x7A
{0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x3E,0xFC,0x40,0x02,0x40,0x02,0x40,0x02,0x00,0x00,0x00,0x00},	// 0x7B
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},	// 0x7C
{0x00,0x00,0x00,0x00,0x40,0x02,0x40,0x02,0x40,0x02,0x3E,0xFC,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00},	// 0x7D
{0x03,0x00,0x00,0x80,0x00,0x80,0x00,0x80,0x01,0x00,0x01,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x01,0x80},	// 0x7E
{0x00,0x00,0x1F,0x80,0x10,0xC0,0x10,0x20,0x10,0x10,0x10,0x20,0x10,0xC0,0x1F,0x80,0x00,0x00,0x00,0x00},	// 0x7F
{0x03,0xC0,0x0C,0x30,0x08,0x10,0x10,0x08,0x10,0x08,0x90,0x08,0xB0,0x08,0xD0,0x18,0x00,0x00,0x00,0x00},	// 0x80

};
  
////////////////
//Declarations//
//////////////// 

//MISC
int main(void);

//ST7735 LCD
void lcd_send(int, int);                           //Write a byte of data via SPI
void lcd_set_xy(int, int);
void lcd_cls(int);
void lcd_draw_pixel(int);
void lcd_putchar(int, int, int, int, int, int);
void lcd_putstring(int, int, char*, int, int, int);

//SPI write data or command to LCD
void lcd_send(int dc, int value)
{
	int t1;
		
	if(!dc) //Cmd (0) or Data(1)?
	{
	    LCDPORT &= ~(LCD_DC);  //Cmd=0
	}
	else
	{
	    LCDPORT |= LCD_DC;     //Data=1
	}
		
	LCDPORT &= ~(LCD_CS);  //CS Low
	
	for(t1 = 7; t1 >= 0; t1--)
	{
		if(value & (1 << t1)) 
	    {
	        LCDPORT |= LCD_SDA;     //1
	    }
	    else
	    {
	        LCDPORT &= ~(LCD_SDA);  //0
	    }
	    	    
	    LCDPORT |= LCD_SCK;     //SCK hi
	    LCDPORT &= ~(LCD_SCK);  //SCK lo
	}
	    
	LCDPORT |= LCD_CS;     //CS hi
}	

//Init LCD to vertical alignement and 16-bit color mode
void lcd_init(void)
{
    lcd_send(LCD_CMD,  0xCB);
    lcd_send(LCD_DATA, 0x39);
    lcd_send(LCD_DATA, 0x2C);
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0x34);
    lcd_send(LCD_DATA, 0x02);

    lcd_send(LCD_CMD, 0xCF);
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0XC1);
    lcd_send(LCD_DATA, 0X30);

    lcd_send(LCD_CMD,  0xE8);
    lcd_send(LCD_DATA, 0x85);
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0x78);

    lcd_send(LCD_CMD,  0xEA);
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0x00);

    lcd_send(LCD_CMD,  0xED);
    lcd_send(LCD_DATA, 0x64);
    lcd_send(LCD_DATA, 0x03);
    lcd_send(LCD_DATA, 0X12);
    lcd_send(LCD_DATA, 0X81);

    lcd_send(LCD_CMD,  0xF7);
    lcd_send(LCD_DATA, 0x20);

    lcd_send(LCD_CMD,  0xC0); // Power control
    lcd_send(LCD_DATA, 0x23); // VRH[5:0]

    lcd_send(LCD_CMD,  0xC1); // Power control
    lcd_send(LCD_DATA, 0x10); // SAP[2:0];BT[3:0]

    lcd_send(LCD_CMD,  0xC5); // VCM control
    lcd_send(LCD_DATA, 0x3e);
    lcd_send(LCD_DATA, 0x28);

    lcd_send(LCD_CMD,  0xC7); // VCM control2
    lcd_send(LCD_DATA, 0x86);

    lcd_send(LCD_CMD,  0x36); // Memory Access Control
    lcd_send(LCD_DATA, 0x88); // C8

    lcd_send(LCD_CMD,  0x3A);
    lcd_send(LCD_DATA, 0x55);

    lcd_send(LCD_CMD,  0xB1);
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0x18);

    lcd_send(LCD_CMD,  0xB6); // Display Function Control
    lcd_send(LCD_DATA, 0x08);
    lcd_send(LCD_DATA, 0x82);
    lcd_send(LCD_DATA, 0x27);

    lcd_send(LCD_CMD,  0xF2); // 3Gamma Function Disable
    lcd_send(LCD_DATA, 0x00);

    lcd_send(LCD_CMD,  0x26); // Gamma curve selected
    lcd_send(LCD_DATA, 0x01);

    lcd_send(LCD_CMD,  0xE0); // Set Gamma
    lcd_send(LCD_DATA, 0x0F);
    lcd_send(LCD_DATA, 0x31);
    lcd_send(LCD_DATA, 0x2B);
    lcd_send(LCD_DATA, 0x0C);
    lcd_send(LCD_DATA, 0x0E);
    lcd_send(LCD_DATA, 0x08);
    lcd_send(LCD_DATA, 0x4E);
    lcd_send(LCD_DATA, 0xF1);
    lcd_send(LCD_DATA, 0x37);
    lcd_send(LCD_DATA, 0x07);
    lcd_send(LCD_DATA, 0x10);
    lcd_send(LCD_DATA, 0x03);
    lcd_send(LCD_DATA, 0x0E);
    lcd_send(LCD_DATA, 0x09);
    lcd_send(LCD_DATA, 0x00);

    lcd_send(LCD_CMD,  0xE1); // Set Gamma
    lcd_send(LCD_DATA, 0x00);
    lcd_send(LCD_DATA, 0x0E);
    lcd_send(LCD_DATA, 0x14);
    lcd_send(LCD_DATA, 0x03);
    lcd_send(LCD_DATA, 0x11);
    lcd_send(LCD_DATA, 0x07);
    lcd_send(LCD_DATA, 0x31);
    lcd_send(LCD_DATA, 0xC1);
    lcd_send(LCD_DATA, 0x48);
    lcd_send(LCD_DATA, 0x08);
    lcd_send(LCD_DATA, 0x0F);
    lcd_send(LCD_DATA, 0x0C);
    lcd_send(LCD_DATA, 0x31);
    lcd_send(LCD_DATA, 0x36);
    lcd_send(LCD_DATA, 0x0F);

    lcd_send(LCD_CMD,  0x11); // Sleep out
    _delay_ms(120);
    lcd_send(LCD_CMD, 0x2c);  
        
    lcd_send(LCD_CMD, 0x29); // Display on 
    lcd_send(LCD_CMD, 0x2c);	
	
}	

void lcd_set_xy(int x, int y)
{
	//X
	lcd_send(LCD_CMD, 0x2B);
    lcd_send(LCD_DATA, x >> 8);
    lcd_send(LCD_DATA, x & 0xFF);
    lcd_send(LCD_CMD, 0x2c);

    //Y 
    lcd_send(LCD_CMD, 0x2A);
    lcd_send(LCD_DATA, y >> 8);
    lcd_send(LCD_DATA, y & 0xFF);
    lcd_send(LCD_CMD, 0x2c);
}
 
void lcd_draw_pixel(int color)
{
    lcd_send(LCD_DATA, color >> 8);
    lcd_send(LCD_DATA, color & 0xFF);
}

void lcd_cls(int bcolor)
{
	int x;
	unsigned char y;
	
	lcd_set_xy(0, 0);
	for(x = 0; x < LCD_WIDTH; x++)
	{
        for(y = 0; y < LCD_HEIGHT; y++)
        {
			lcd_draw_pixel(bcolor);
		}	
	}
}		

//Write character from font set to destination on screen
void lcd_putchar(int x, int y, int c, int size, int fcolor, int bcolor)
{
    int x0;
    int t0, t1, t2, t3, u;
       
    x0 = x;
    for(t0 = 0; t0 < FONTWIDTH * 2; t0 += 2)
    { 
		for(t1 = 0; t1 < size; t1++)
		{
		    u = xchar[c][t0 + 1] + (xchar[c][t0] << 8);
		    lcd_set_xy(x0, y);
		    for(t2 = 16; t2 >= 0; t2--)
		    {
			    if(u & (1 << t2))
			    {
				    for(t3 = 0; t3 < size; t3++)
				    {
		                lcd_draw_pixel(fcolor);
		            }
		        }    
		        else
		        {
		            for(t3 = 0; t3 < size; t3++)
				    {
		                lcd_draw_pixel(bcolor);
		            }
		        }
		    }
		    x0++;
		}    
	}	
}	

void lcd_putstring(int x, int y, char *text, int size, int fcolor, int bcolor)
{
	int t1 = 0, x0;
	 
	x0 = x;
	while(text[t1])
	{
		lcd_putchar(x0, y, text[t1], size, fcolor, bcolor);
		x0 += (size * FONTWIDTH);
		t1++;
	}
}		

int main(void)
{
    LCDDDR = 0x1F;
    	
    LCDPORT &= ~(LCD_RES);  //0
	_delay_ms(5);
    LCDPORT |= LCD_RES;     //1
    _delay_ms(5);
    LCDPORT &= ~(LCD_CS);  //0
    _delay_ms(5);
    
    lcd_init();        
    lcd_cls(BLUE);    
    lcd_putchar(200, 0, 0x03, 2, WHITE, BLUE);
    lcd_putstring(100, 100, "HALLO", 2, YELLOW, BLUE);
    lcd_putstring(0, 0, "JUTTI!!!", 2, WHITE, BLUE);
    while(1);
          
	return 0;
}
